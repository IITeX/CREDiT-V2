# NFT Creation System Documentation

## Overview

The CREDiT platform uses a dual-ID system for managing credentials and NFTs. Understanding this system is crucial for proper implementation and debugging.

## Dual-ID System

### 1. Credential ID
- **Format**: `SK-1749407266732902981` (type prefix + timestamp)
- **Purpose**: Identifies the actual credential data
- **Used by**: `getCredential(credentialId)` function
- **Generated by**: `generateCredentialId()` function in the backend

### 2. Token ID (NFT ID)
- **Format**: 
  - User tokens: `CREDiT-1`, `CREDiT-2`, etc.
  - Issuer tokens: `ED-2025-001`, `CO-2025-042`, etc.
- **Purpose**: Identifies the NFT token for blockchain operations
- **Used by**: `getNFT(tokenId)` and `getCredentialByToken(tokenId)` functions
- **Generated by**: 
  - `generateTokenId()` for user tokens
  - `generateIssuerTokenId()` for issuer tokens

## Creation Process

### When `createCredential()` is called:
```motoko
// Backend generates both IDs
let credentialId = generateCredentialId(credentialType);  // SK-1749407266732902981
let tokenId = generateTokenId();                          // CREDiT-1

// Both are stored in the credential object
let credential = {
  id = credentialId;
  tokenId = tokenId;
  // ... other fields
};
```

### When `createSoulBoundToken()` is called (for issuers):
```motoko
// Backend generates both IDs
let credentialId = generateCredentialId(credentialType);  // SK-1749407266732902981
let tokenId = generateIssuerTokenId(issuerType);          // ED-2025-001

// Both are stored in the credential object
let credential = {
  id = credentialId;
  tokenId = tokenId;
  // ... other fields
};
```

## Function Usage Guide

### ✅ Correct Usage

#### For Credential Data Operations:
```typescript
// Use Credential ID (SK-1749407266732902981)
const credential = await getCredentialById("SK-1749407266732902981");
```

#### For NFT/Token Operations:
```typescript
// Use Token ID (CREDiT-1 or ED-2025-001)
const nft = await getNFT("ED-2025-001");
const credential = await getCredentialByToken("ED-2025-001");
```

#### For Search Operations:
```typescript
// Users search by Token ID (what they see publicly)
const searchResults = await searchCredentials("ED-2025-001");
```

### ❌ Common Mistakes

```typescript
// DON'T use Credential ID for NFT operations
const nft = await getNFT("SK-1749407266732902981"); // ❌ Wrong!

// DON'T use Token ID for direct credential access
const credential = await getCredential("ED-2025-001"); // ❌ Wrong!
```

## Frontend Implementation

### Issuer Dashboard Display
```typescript
// Show both IDs for clarity
<div>
  <h4>{credential.tokenId}</h4>                    {/* ED-2025-001 */}
  <p>Credential ID: {credential.id}</p>            {/* SK-1749407266732902981 */}
  
  <Button onClick={() => copyToClipboard(credential.tokenId)}>
    Copy Token ID
  </Button>
  <Button onClick={() => copyToClipboard(credential.id)}>
    Copy Credential ID
  </Button>
</div>
```

### Search Functionality
```typescript
// Search uses Token ID (public-facing)
const handleSearch = async (tokenId: string) => {
  const credential = await getCredentialByToken(tokenId); // ED-2025-001
  if (credential) {
    // Navigate using Token ID
    window.location.href = `/credential/${tokenId}`;
  }
};
```

### API Response Structure
```typescript
// When creating a credential, you get both IDs
const result = await createSoulBoundToken(data);
console.log(result.tokenId);        // "ED-2025-001" (for public use)
console.log(result.credentialId);   // "SK-1749407266732902981" (for internal use)
```

## Token ID Formats

### User Tokens (createCredential)
- **Format**: `CREDiT-{counter}`
- **Examples**: `CREDiT-1`, `CREDiT-2`, `CREDiT-100`
- **Use case**: Individual users creating personal credentials

### Issuer Tokens (createSoulBoundToken)
- **Format**: `{TYPE}-{YEAR}-{COUNTER}`
- **Examples**: 
  - `ED-2025-001` (Educational institution)
  - `CO-2025-042` (Company/Organization)
  - `CB-2025-015` (Certification Body)
  - `NG-2025-008` (NGO/Non-Profit)
  - `PM-2025-023` (Platform/Marketplace)

## Backend Canister Methods

### Available Methods:
```motoko
// Credential operations (use Credential ID)
getCredential: (credentialId: Text) -> Result<Credential, Text>

// NFT operations (use Token ID)
getNFT: (tokenId: Text) -> Result<NFT, Text>
getCredentialByToken: (tokenId: Text) -> Result<Credential, Text>

// Search operations (use Token ID)
searchCredentials: (query: Text) -> [Credential]
```

## Best Practices

### 1. Display Strategy
- **Public-facing**: Always show Token ID (`ED-2025-001`)
- **Internal/Debug**: Show both IDs for clarity
- **Search**: Use Token ID for user searches

### 2. Storage Strategy
- **Frontend state**: Store both IDs when available
- **URL parameters**: Use Token ID for public URLs
- **API calls**: Use appropriate ID for each function

### 3. Error Handling
```typescript
// Handle both ID types in error messages
if (!credential) {
  if (id.startsWith('SK-') || id.startsWith('ED-') || id.startsWith('CO-')) {
    setError(`Credential not found for ID: ${id}`);
  } else {
    setError(`Invalid ID format: ${id}`);
  }
}
```

## Migration Notes

### If you need to convert between IDs:
```typescript
// Get Token ID from Credential ID
const credential = await getCredentialById("SK-1749407266732902981");
const tokenId = credential.tokenId; // "ED-2025-001"

// Get Credential ID from Token ID
const credential = await getCredentialByToken("ED-2025-001");
const credentialId = credential.id; // "SK-1749407266732902981"
```

## Debugging Tips

### 1. Check ID Format
- Credential IDs: Always start with type prefix + timestamp
- Token IDs: Follow specific patterns (CREDiT-X or TYPE-YEAR-XXX)

### 2. Verify Function Usage
- Use Token ID for public operations
- Use Credential ID for internal data access

### 3. Console Logging
```typescript
console.log('Token ID:', credential.tokenId);     // For public use
console.log('Credential ID:', credential.id);     // For internal use
```

## Summary

- **Token ID** (`ED-2025-001`, `CREDiT-1`) = Public-facing identifier for NFT operations
- **Credential ID** (`SK-1749407266732902981`) = Internal identifier for credential data
- **Search & Display** = Use Token ID
- **Direct Data Access** = Use appropriate ID for the specific function
- **Both IDs are generated and stored** when creating any credential
